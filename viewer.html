<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const rawFile = urlParams.get('file');

  const pathEl = document.getElementById('path');
  const contentEl = document.getElementById('content');

  if (!rawFile) {
    contentEl.textContent = 'file 파라미터가 없습니다.';
  } else {
    const decodedFile = decodeURIComponent(rawFile);
    pathEl.textContent = decodedFile;

    const targetUrl = '/' + decodedFile;

    fetch(targetUrl)
      .then(async (res) => {
        const text = await res.text();
        const ct = res.headers.get('content-type') || '';

        if (!res.ok) {
          throw new Error(`HTTP ${res.status}\n요청: ${targetUrl}`);
        }

        // Netlify 404 페이지가 HTML로 오는 경우 잡기
        if (ct.includes('text/html')) {
          throw new Error(`MD 대신 HTML이 응답으로 왔습니다.\n요청: ${targetUrl}\n(대개 Netlify 404/리다이렉트 문제)`);
        }

        contentEl.innerHTML = marked.parse(text);
      })
      .catch((err) => {
        contentEl.innerHTML = `
          <div style="color:red; border:1px solid red; padding:10px; white-space:pre-wrap;">
            ❌ 불러오기 실패
            ${err.message}

            요청 URL: ${window.location.origin}${targetUrl}
          </div>
        `;
      });
  }
</script>
