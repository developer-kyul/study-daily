<!doctype html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MD Viewer</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.6.1/github-markdown.min.css" />

    <style>
      body {
        margin: 0;
        padding: 24px;
      }
      .markdown-body {
        max-width: 920px;
        margin: 0 auto;
      }
      .top {
        max-width: 920px;
        margin: 0 auto 16px;
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .top a {
        text-decoration: none;
      }
      .path {
        opacity: 0.7;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="top">
      <a href="./index.html">← 목록으로</a>
      <span class="path" id="path"></span>
    </div>

    <article class="markdown-body" id="content">로딩 중...</article>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      const params = new URLSearchParams(location.search);
      // 1. URL에서 파일 경로를 가져옵니다.
      let file = params.get('file');

      const pathEl = document.getElementById('path');
      const contentEl = document.getElementById('content');

      if (!file) {
        contentEl.textContent = 'file 파라미터가 없습니다.';
      } else {
        // 2. [중요] 한글 파일명을 위해 디코딩을 수행합니다.
        file = decodeURIComponent(file);
        pathEl.textContent = file;

        // 3. 파일을 불러옵니다. (앞에 ./ 를 붙여 현재 위치 기준임을 명시)
        fetch('./' + file)
          .then((res) => {
            if (!res.ok) throw new Error('파일을 불러올 수 없음: ' + res.status);
            return res.text();
          })
          .then((md) => {
            contentEl.innerHTML = marked.parse(md);
          })
          .catch((err) => {
            contentEl.style.whiteSpace = 'pre-wrap';
            contentEl.innerHTML = `<p style="color:red;">불러오기 실패: ${err.message}</p>
                                   <p>찾으려는 경로: <b>${file}</b></p>`;
          });
      }
    </script>
  </body>
</html>
