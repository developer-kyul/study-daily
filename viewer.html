<!doctype html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MD Viewer</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.6.1/github-markdown.min.css" />

    <style>
      body {
        margin: 0;
        padding: 24px;
      }
      .markdown-body {
        max-width: 920px;
        margin: 0 auto;
      }
      .top {
        max-width: 920px;
        margin: 0 auto 16px;
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .top a {
        text-decoration: none;
      }
      .path {
        opacity: 0.7;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="top">
      <a href="./index.html">← 목록으로</a>
      <span class="path" id="path"></span>
    </div>

    <article class="markdown-body" id="content">로딩 중...</article>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      // 1. URL에서 파일 경로를 가져오고 즉시 디코딩합니다.
      const urlParams = new URLSearchParams(window.location.search);
      const rawFile = urlParams.get('file');

      const pathEl = document.getElementById('path');
      const contentEl = document.getElementById('content');

      // 2. 파일 파라미터가 있는지 확인
      if (!rawFile) {
        contentEl.textContent = 'file 파라미터가 없습니다.';
      } else {
        // 한글 파일명을 위해 디코딩 수행
        const decodedFile = decodeURIComponent(rawFile);
        pathEl.textContent = decodedFile;

        // 3. 파일 불러오기
        // 호출 경로가 'src/study-review-js/...' 라면
        // 현재 viewer.html 위치를 기준으로 파일을 찾습니다.
        fetch('./' + decodedFile)
          .then((res) => {
            if (!res.ok) throw new Error('파일을 불러올 수 없음 (상태 코드: ' + res.status + ')');
            return res.text();
          })
          .then((md) => {
            // 마크다운 변환 및 화면 출력
            contentEl.innerHTML = marked.parse(md);
          })
          .catch((err) => {
            contentEl.innerHTML = `
          <p style="color:red; font-weight:bold;">❌ 불러오기 실패</p>
          <p>에러 메시지: ${err.message}</p>
          <p>확인 중인 경로: <code style="background:#eee; padding:2px 5px;">${decodedFile}</code></p>
          <small>팁: 폴더 구조가 맞는지, 한글 파일명이 실제와 똑같은지 확인하세요.</small>
        `;
          });
      }
    </script>
  </body>
</html>
