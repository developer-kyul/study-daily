<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const rawFile = urlParams.get('file');

    const pathEl = document.getElementById('path');
    const contentEl = document.getElementById('content');

    // ğŸ”’ ì•ˆì „ì¥ì¹˜ (ì´ì œ null ì—ëŸ¬ ì ˆëŒ€ ì•ˆ ë‚¨)
    if (!pathEl || !contentEl) {
      document.body.innerHTML = `
        <div style="padding:16px; color:red;">
          âŒ viewer.html í…œí”Œë¦¿ì—
          <code>id="path"</code> ë˜ëŠ”
          <code>id="content"</code> ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      `;
      return;
    }

    if (!rawFile) {
      contentEl.textContent = 'file íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
      return;
    }

    const decodedFile = decodeURIComponent(rawFile);
    pathEl.textContent = decodedFile;

    const targetUrl = '/' + decodedFile;

    fetch(targetUrl)
      .then(async (res) => {
        const text = await res.text();
        const ct = res.headers.get('content-type') || '';

        if (!res.ok) {
          throw new Error(`HTTP ${res.status}\nìš”ì²­: ${targetUrl}`);
        }

        // Netlify 404 í˜ì´ì§€ê°€ HTMLë¡œ ì˜¤ëŠ” ê²½ìš°
        if (ct.includes('text/html')) {
          throw new Error(`MD ëŒ€ì‹  HTMLì´ ì‘ë‹µìœ¼ë¡œ ì™”ìŠµë‹ˆë‹¤.\nìš”ì²­: ${targetUrl}\n(Netlify 404 ë˜ëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¬¸ì œ)`);
        }

        contentEl.innerHTML = marked.parse(text);
      })
      .catch((err) => {
        contentEl.innerHTML = `
          <div style="color:red; border:1px solid red; padding:10px; white-space:pre-wrap;">
            âŒ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨
            ${err.message}

            ìš”ì²­ URL: ${window.location.origin}${targetUrl}
          </div>
        `;
        console.error(err);
      });
  });
</script>
